//create table penunjukan_pp


//-- end


//create v_user_pp
create views v_user_pp AS
select users.*, from users where role_id = 5

//-- end


//untuk create view perkara
CREATE VIEW v_all_perkara AS
SELECT list_perkara.*, users.nama FROM list_perkara JOIN users ON list_perkara.id_user = users.id
//-- end untuk create view perkara

//untuk create view perkara yang dilihat hakim
CREATE VIEW v_all_perkara_hakim AS
SELECT list_perkara.*, users.nama FROM list_perkara JOIN users ON list_perkara.id_user = users.id
WHERE list_perkara.is_nomor = 1;

//-- end untuk create view perkara yang dilihat hakim


//untuk audit trail
CREATE TABLE `log_audittrail` (
  `log_id` int(5) NOT NULL,
  `isi_log` text CHARACTER SET latin1 DEFAULT NULL,
  `rekam_log` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `nama_log` varchar(50) CHARACTER SET latin1 DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
//--end audit trail


//untuk notifikasi inbox
//jalankan pertama
CREATE TABLE `log_inbox` (
  `id_log_inbox` int(11) NOT NULL,
  `id_perkara` int(11) NOT NULL,
  `no_perkara` varchar(50) NOT NULL,
  `is_read` int(11) NOT NULL,
  `change_date` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

//jalankan kedua
DELIMITER $$
CREATE TRIGGER `insert_log_inbox` AFTER INSERT ON `list_perkara` FOR EACH ROW BEGIN
    INSERT INTO log_inbox (id_log_inbox, id_perkara, no_perkara, is_read, change_date)
    VALUES ("", new.id_perkara, new.no_perkara, 1, now());
END
$$
DELIMITER ;

//--end untuk notifikasi inbox
